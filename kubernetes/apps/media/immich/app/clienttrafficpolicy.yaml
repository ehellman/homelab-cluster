# Disable HTTP/3 for Immich to fix iOS upload issues
# iOS auto-negotiates to QUIC but uploads fail with 0 bytes received
---
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: ClientTrafficPolicy
metadata:
  name: immich-client-policy
spec:
  targetRefs:
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      name: immich-internal
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      name: immich-external
  # HTTP/2 settings with tuned window sizes for uploads
  # No http3 field = HTTP/3 disabled for Immich
  http2:
    initialStreamWindowSize: 16Mi
    initialConnectionWindowSize: 24Mi
