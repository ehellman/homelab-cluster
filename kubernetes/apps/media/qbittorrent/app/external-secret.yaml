# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
#
# Fetches VPN credentials from 1Password for gluetun.
#
# 1Password item: "qbittorrent-vpn"
# Required fields:
#   - vpn_service_provider: e.g., "private internet access" or "mullvad"
#   - vpn_user: VPN username (PIA username or Mullvad account number)
#   - vpn_password: VPN password (PIA password or empty for Mullvad)
#   - server_regions: e.g., "Netherlands" or "Sweden"
#
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: qbittorrent-vpn
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: qbittorrent-vpn
    template:
      engineVersion: v2
      data:
        VPN_SERVICE_PROVIDER: "{{ .vpn_service_provider }}"
        OPENVPN_USER: "{{ .vpn_user }}"
        OPENVPN_PASSWORD: "{{ .vpn_password }}"
        SERVER_REGIONS: "{{ .server_regions }}"
  data:
    - secretKey: vpn_service_provider
      remoteRef:
        key: qbittorrent-vpn
        property: vpn_service_provider
    - secretKey: vpn_user
      remoteRef:
        key: qbittorrent-vpn
        property: vpn_user
    - secretKey: vpn_password
      remoteRef:
        key: qbittorrent-vpn
        property: vpn_password
    - secretKey: server_regions
      remoteRef:
        key: qbittorrent-vpn
        property: server_regions
