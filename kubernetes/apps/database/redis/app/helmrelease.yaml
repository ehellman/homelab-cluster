# Shared Valkey (Redis-compatible) instance
#
# Uses official Valkey Helm chart: https://github.com/valkey-io/valkey-helm
# Apps connect via: redis-valkey.database.svc.cluster.local:6379
# Use different REDIS_DBINDEX (0-15) per app for isolation.
#
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: redis
spec:
  interval: 1h
  chart:
    spec:
      chart: valkey
      version: 0.9.2
      sourceRef:
        kind: HelmRepository
        name: valkey
      interval: 1h
  values:
    # Authentication
    auth:
      enabled: true
      usersExistingSecret: redis-secret
      aclUsers:
        default:
          passwordKey: REDIS_PASSWORD
          permissions: "~* &* +@all"

    # No persistence (ephemeral cache)
    dataStorage:
      enabled: false

    # Resources
    resources:
      requests:
        cpu: 10m
        memory: 64Mi
      limits:
        memory: 256Mi
